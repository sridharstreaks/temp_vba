Sub ExportAndMoveFile_IE()

    Dim ie As Object
    Dim user_id As String
    Dim downloadFolder As String
    Dim csvFilePath As String
    Dim folderPath As String
    Dim fileName As String
    Dim fs As Object
    Dim file As Object
    Dim found As Boolean

    ' Step 1: Create a new instance of Internet Explorer
    Set ie = CreateObject("InternetExplorer.Application")
    
    ' Make Internet Explorer visible
    ie.Visible = True

    ' Step 2: Navigate to the webpage
    ie.Navigate "https://yourwebsite.com" ' Replace with the correct URL

    ' Wait until the page is fully loaded
    Do While ie.Busy Or ie.readyState <> 4
        DoEvents
    Loop

    ' Step 3: Find the element "(//div[@tabindex='0'])[last()]" and click on it
    ie.document.querySelectorAll("div[tabindex='0']")(ie.document.querySelectorAll("div[tabindex='0']").length - 1).Click

    ' Wait for the page to respond after the click (optional)
    Application.Wait (Now + TimeValue("0:00:2"))

    ' Step 4: Find the element "//div[@data-lol-id='vis_dropdown']" and click on it
    ie.document.querySelector("div[data-lol-id='vis_dropdown']").Click

    ' Wait for the page to respond after the click (optional)
    Application.Wait (Now + TimeValue("0:00:2"))

    ' Step 5: Find the element "//li[@data-lol-id='dashboard_export']" and click on it
    ie.document.querySelector("li[data-lol-id='dashboard_export']").Click

    ' Step 6: Get Windows user login ID and enter it into the download path
    user_id = Environ("USERNAME")
    downloadFolder = "C:\Users\" & user_id & "\Downloads"

    ' Step 7: Check for a CSV file containing the name partially "Mtd_Achievement, _Gap_"
    found = False
    Set fs = CreateObject("Scripting.FileSystemObject")
    
    ' Loop through files in the download folder
    For Each file In fs.GetFolder(downloadFolder).Files
        If InStr(file.Name, "Mtd_Achievement") > 0 And InStr(file.Name, "_Gap_") > 0 And fs.GetExtensionName(file.Name) = "csv" Then
            fileName = file.Name
            found = True
            Exit For
        End If
    Next file

    ' Step 8: Move the file if found
    If found Then
        ' Create the destination folder if it does not exist
        folderPath = "C:\Users\" & user_id & "\Desktop\raw_data\curr_week"
        If Not fs.FolderExists(folderPath) Then
            fs.CreateFolder folderPath
        End If

        ' Move the file to the destination folder
        fs.MoveFile downloadFolder & "\" & fileName, folderPath & "\" & fileName
        MsgBox "File moved successfully: " & fileName
    Else
        MsgBox "No CSV file found matching the criteria."
    End If

    ' Close Internet Explorer
    ie.Quit

    ' Clean up the IE object
    Set ie = Nothing

End Sub
