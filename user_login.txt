Sub RunCmdAndGetOutput()

    Dim objShell As Object
    Dim objExec As Object
    Dim strCommand As String
    Dim strOutput As String

    ' Command to execute (e.g., "ipconfig /all")
    strCommand = "ipconfig /all"

    ' Create a Shell object
    Set objShell = CreateObject("WScript.Shell")

    ' Execute the command
    Set objExec = objShell.Exec("%comspec% /c " & strCommand)

    ' Read the output
    strOutput = objExec.StdOut.ReadAll

    ' Display the output (or process it as needed)
    MsgBox strOutput

    ' Clean up
    Set objExec = Nothing
    Set objShell = Nothing

End Sub

' Example with error handling and timeout (more robust)
Sub RunCmdWithTimeout()

    Dim objShell As Object
    Dim objExec As Object
    Dim strCommand As String
    Dim strOutput As String
    Dim iTimeout As Long
    Dim startTime As Double

    strCommand = "ping 8.8.8.8 -n 2" ' Example command
    iTimeout = 5000 ' Timeout in milliseconds (5 seconds)

    Set objShell = CreateObject("WScript.Shell")
    Set objExec = objShell.Exec("%comspec% /c " & strCommand)

    startTime = Timer * 1000 ' Get start time in milliseconds

    Do While objExec.Status = 0
        DoEvents ' Allow other processes to run
        If (Timer * 1000) - startTime > iTimeout Then
            MsgBox "Command timed out."
            Exit Sub
        End If
    Loop

    strOutput = objExec.StdOut.ReadAll

    MsgBox strOutput

    Set objExec = Nothing
    Set objShell = Nothing

End Sub

' Example that reads stderr for error messages.
Sub RunCmdWithErrorCheck()

    Dim objShell As Object
    Dim objExec As Object
    Dim strCommand As String
    Dim strOutput As String
    Dim strError As String

    strCommand = "nonexistentcommand" ' Example command that will fail

    Set objShell = CreateObject("WScript.Shell")
    Set objExec = objShell.Exec("%comspec% /c " & strCommand)

    Do While objExec.Status = 0
        DoEvents
    Loop

    strOutput = objExec.StdOut.ReadAll
    strError = objExec.StdErr.ReadAll

    If Len(strError) > 0 Then
        MsgBox "Error: " & strError
    Else
        MsgBox "Output: " & strOutput
    End If

    Set objExec = Nothing
    Set objShell = Nothing

End Sub
